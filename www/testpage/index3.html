<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <title>Collapsible sidebar using Bootstrap 3</title>

        <!-- Bootstrap CSS CDN -->
        <!-- google map api key: AIzaSyAUo5900VPnf6Mp0q-jqKdlKWsf189Iqvg -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <!-- Our Custom CSS -->
        <link rel="stylesheet" href="style3.css">
        <!-- Scrollbar Custom CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
        <link href="https://use.fontawesome.com/releases/v5.0.1/css/all.css" rel="stylesheet">

    </head>
    <body>

        <div class="wrapper">
            <!-- Sidebar Holder -->
            <nav id="sidebar">
                <div id="dismiss">
                    <i class="glyphicon glyphicon-arrow-left"></i>
                </div>

                <div class="sidebar-header">
                    <h3>Bootstrap Sidebar</h3>
                </div>

                <ul class="list-unstyled components">
                    <p>Dummy Heading</p>
                    <li class="active">
                        <a href="#homeSubmenu" data-toggle="collapse" aria-expanded="false">Home</a>
                        <ul class="collapse list-unstyled" id="homeSubmenu">
                            <li><a href="#">Home 1</a></li>
                            <li><a href="#">Home 2</a></li>
                            <li><a href="#">Home 3</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#">About</a>
                        <a href="#pageSubmenu" data-toggle="collapse" aria-expanded="false">Pages</a>
                        <ul class="collapse list-unstyled" id="pageSubmenu">
                            <li><a href="#">Page 1</a></li>
                            <li><a href="#">Page 2</a></li>
                            <li><a href="#">Page 3</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#">Portfolio</a>
                    </li>
                    <li>
                        <a href="#">Contact</a>
                    </li>
                </ul>

                <ul class="list-unstyled CTAs">
                    <li><a href="https://bootstrapious.com/tutorial/files/sidebar.zip" class="download">Download source</a></li>
                    <li><a href="https://bootstrapious.com/p/bootstrap-sidebar" class="article">Back to article</a></li>
                </ul>
            </nav>

            <!-- Page Content Holder -->
            <div id="content">

                <nav class="navbar navbar-default">
                    <div class="container-fluid">

                        <div class="navbar-header">
                            <button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn">
                                <i class="glyphicon glyphicon-align-left"></i>
                                <span>Open Sidebar</span>
                            </button>
                        </div>

                        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                            <ul class="nav navbar-nav navbar-right">
                                <li><a href="#">Page</a></li>
                                <li><a href="#">Page</a></li>
                                <li><a href="#">Page</a></li>
                                <li><a href="#">Page</a></li>
                            </ul>
                        </div>
                    </div>
                </nav>
                <!--trip-plan-cells-->
                <div class="trip">
                    <div class="panel-group" id="trip-titles">
                        <div class="trip-cell">
                            <a href="#mytrip1" class="panel panel-default" data-toggle="collapse" aria-expanded="false">
                                <img src="landscape1.jpg"/>
                                <img src="dog2.jpg" class="trip-cell-profile-img"/>
                                <div class="trip-cell-title">日本東京之旅</div>
                                <div class="trip-cell-date">2017/10/10~2017/10/15</div>
                            </a>
                        </div>
                        <div class="collapse trip-day" id="mytrip1">
                            <!--a href="#day1" class="panel panel-default" data-toggle="collapse" aria-expanded="false"-->
                            <div class="day-flag">
                                    第一天(10/5)
                            </div>
                            <div style="margin-top:5px;" class="trip-list">
                                <ul class="trip-list-number" style="float:left;">
                                    <li><span>10:00</span></li>
                                    <li><i class="fas fa-map-marker-alt fa-3x"></i></li>
                                    <li><span>12:00</span></li>
                                </ul>
                                <p class="trip-list-title">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;晴空樹<br><span>&nbsp;&nbsp;日本東京都墨田區押上１丁目１−２</span></p>
                            </div>
                            <div class="trip-list-addbtn"><i class="fas fa-plus-square fa-3x">新增旅遊景點</i></div>
                        </div>
                        <!-- <div id="map"></div> -->
                    </div>
                </div>
                <!-- <i class="fas fa-plus-circle fa-7x" style="color:blue; position:fixed; bottom:20px; right:20px;"></i> -->
            </div>
        </div>



        <div class="overlay"></div>
        <dialog id="dialog">
            <input id="autocomplete" placeholder="Enter your address" type="text" class="controls">
            <div id="map"></div>
            <div id="listing">
              <table id="resultsTable">
                <tbody id="results"></tbody>
              </table>
            </div>
          </table>
        </div>
          <!-- <div id="okbtn">OK</div>
          <div id="cancelbtn">cancel</div> -->
        </dialog>


        <!-- jQuery CDN -->
        <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
        <!-- Bootstrap Js CDN -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <!-- jQuery Custom Scroller CDN -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQoy_tqD6vBnTFbPqpiezn3aUIGjGsOsU&libraries=places&callback=initMap"  async defer></script>

        <script type="text/javascript">
            $(document).ready(function () {
                $("#sidebar").mCustomScrollbar({
                    theme: "minimal"
                });

                $('#dismiss, .overlay').on('click', function () {
                    $('#sidebar').removeClass('active');
                    $('.overlay').fadeOut();
                });

                $('#sidebarCollapse').on('click', function () {
                    $('#sidebar').addClass('active');
                    $('.overlay').fadeIn();
                    $('.collapse.in').toggleClass('in');
                    $('a[aria-expanded=true]').attr('aria-expanded', 'false');
                });

                $('.trip-list-addbtn').on('click', function (){
                    $('.overlay').fadeIn();
                    $('#dialog')[0].show();
                    google.maps.event.trigger(map, 'resize');
                });
                $('#okbtn').on('click', function (){
                    $('.overlay').fadeOut();
                    $('#dialog')[0].close();
                });
                // initMap();

            });
            var map, places, infoWindow,markerLetter,marker,i;
            var markers = [];
            var autocomplete;
            var MARKER_PATH = 'https://developers.google.com/maps/documentation/javascript/images/marker_green';
            var regular_marker = 'https://maps.gstatic.com/mapfiles/api-3/images/spotlight-poi.png';
            function initMap() {
                      map = new google.maps.Map(document.getElementById('map'), {
                      center: {lat: -34.397, lng: 150.644},
                      zoom: 6
                    });
                    // Try HTML5 geolocation.
                    if (navigator.geolocation) {
                      navigator.geolocation.getCurrentPosition(function(position) {
                        var pos = {
                          lat: position.coords.latitude,
                          lng: position.coords.longitude
                        };
                        map.setCenter(pos);
                        map.setZoom(14);
                      }, function() {
                        handleLocationError(true, infoWindow, map.getCenter());
                      });
                    } else {
                      // Browser doesn't support Geolocation
                      handleLocationError(false, infoWindow, map.getCenter());
                    }
                    var input = document.getElementById('autocomplete');
                     places = new google.maps.places.PlacesService(map);
                    map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
                    var searchBox = new google.maps.places.SearchBox(input);
                    searchBox.addListener('places_changed', function() {
                        var places = searchBox.getPlaces();
                          if (places.length == 0) {
                            return;
                          }
                          // Clear out the old markers.
                          markers.forEach(function(marker) {
                            marker.setMap(null);
                          });
                          markers = [];
                          // For each place, get the icon, name and location.
                          i = 0;
                          var bounds = new google.maps.LatLngBounds();
                          places.forEach(function(place) {
                            if (!place.geometry) {
                              console.log("Returned place contains no geometry");
                              return;
                            }
                            markerLetter = String.fromCharCode('A'.charCodeAt(0) + (i % 26));
                            var markerIcon = MARKER_PATH + markerLetter + '.png';
                            if (places.length == 1) {
                                markerIcon = regular_marker;
                            }
                            // Create a marker for each place.
                            markers.push(new google.maps.Marker({
                              map: map,
                              icon: markerIcon,
                              title: place.name,
                              position: place.geometry.location
                            }));

                            if (place.geometry.viewport) {
                              // Only geocodes have viewport.
                              bounds.union(place.geometry.viewport);
                            } else {
                              bounds.extend(place.geometry.location);
                            }
                            addResult(places[i], i);
                            i++;
                          });
                          map.fitBounds(bounds);
                    });
                    var clickHandler = new ClickEventHandler(map, origin);
                    // map.addListener(map,'rightclick',function(event){showContextMenu(event.latLng);});
                    // map.addListener(map,'rightclick',function(event){showContextMenu(event.placeId,event.latLng);});
                    // map.addListener('rightclick',function(event){console.log(event)});
                  }

              /**
            * @constructor
            */
           var ClickEventHandler = function(map, origin) {
             this.origin = origin;
             this.map = map;
             this.directionsService = new google.maps.DirectionsService;
             this.directionsDisplay = new google.maps.DirectionsRenderer;
             this.directionsDisplay.setMap(map);
             this.placesService = new google.maps.places.PlacesService(map);
             this.infowindow = new google.maps.InfoWindow;
             this.infowindowContent = document.getElementById('infowindow-content');
             this.infowindow.setContent(this.infowindowContent);

             // Listen for clicks on the map.
             this.map.addListener('click', this.handleClick.bind(this));
             this.map.addListener('rightclick', this.handleRightClick.bind(this));
           };
           ClickEventHandler.prototype.handleRightClick = function(event) {
               console.log(event);
           }

           ClickEventHandler.prototype.handleClick = function(event) {
             // console.log('You clicked on: ' + event.latLng);
             // If the event has a placeId, use it.
             console.log(event);
             if (event.placeId) {
               // Calling e.stop() on the event prevents the default info window from
               // showing.
               // If you call stop here when there is no placeId you will prevent some
               // other map click event handlers from receiving the event.
               event.stop();
               var request = {
                  placeId: event.placeId
                };
                //use placeId to get place info
                service = new google.maps.places.PlacesService(map);
                service.getDetails(request, callback);
                function callback(place, status) {

                  if (status == google.maps.places.PlacesServiceStatus.OK) {
                      if(marker){
                          marker.setMap(null);
                      }
                      if (markers){
                          markers.forEach(function(marker) {
                            marker.setMap(null);
                          });
                      }
                       marker = new google.maps.Marker({
                          position: event.latLng,
                          map: map,
                          title: place.name
                        });
                  }
                }
               // this.getPlaceInformation(event.placeId);
             }
           };
           function addResult(result, i) {
              var results = document.getElementById('results');
              var markerLetter = String.fromCharCode('A'.charCodeAt(0) + (i % 26));
              var markerIcon = MARKER_PATH + markerLetter + '.png';

              var tr = document.createElement('tr');
              tr.style.backgroundColor = (i % 2 === 0 ? '#F0F0F0' : '#FFFFFF');
              tr.onclick = function() {
                google.maps.event.trigger(markers[i], 'click');
              };

              var iconTd = document.createElement('td');
              var nameTd = document.createElement('td');
              var icon = document.createElement('img');
              icon.src = markerIcon;
              icon.setAttribute('class', 'placeIcon');
              icon.setAttribute('className', 'placeIcon');
              var name = document.createTextNode(result.name);
              iconTd.appendChild(icon);
              nameTd.appendChild(name);
              tr.appendChild(iconTd);
              tr.appendChild(nameTd);
              results.appendChild(tr);
            }

           // ClickEventHandler.prototype.getPlaceInformation = function(placeId) {
           //  var me = this;
           //  this.placesService.getDetails({placeId: placeId}, function(place, status) {
           //    if (status === 'OK') {
           //      me.infowindow.close();
           //      me.infowindow.setPosition(place.geometry.location);
           //      me.infowindowContent.children['place-icon'].src = place.icon;
           //      me.infowindowContent.children['place-name'].textContent = place.name;
           //      me.infowindowContent.children['place-id'].textContent = place.place_id;
           //      me.infowindowContent.children['place-address'].textContent =
           //          place.formatted_address;
           //      me.infowindow.open(me.map);
           //      }});
           //  };


        </script>
    </body>
</html>
